# ๐ ุฏููู ุฅุถุงูุฉ ุณูุฑูุฑ ุฌุฏูุฏ (New Server Protocol)

ูุฐุง ุงูุฏููู ููุถุญ ุงูุฎุทูุงุช ุงูููุงุณูุฉ ูุฅุถุงูุฉ ุณูุฑูุฑ GitHub ุฌุฏูุฏ ูู "Worker" ููุธุงู FB OTPุ ูุน ุชุฌูุจ ุฌููุน ุงูุฃุฎุทุงุก ุงูุณุงุจูุฉ (ูุดุงูู ุงููุฑูุนุ ุงูุตูุงุญูุงุชุ ูุงูู Secrets).

---

## ๐ข ุงููุฑุญูุฉ 1: ูุง ูุฑุณูู ุงููุณุชุฎุฏู (User Inputs)

ูุฅุนุฏุงุฏ ุณูุฑูุฑ ุฌุฏูุฏุ ุฃุญุชุงุฌ ููู ุดูุฆุงู ูุงุญุฏุงู ููุท:

### 1. **GitHub Personal Access Token (Classic)**
- **Scopes ุงููุทููุจุฉ:**
  - `repo` (Full control)
  - `workflow`
  - `delete_repo` (ุงุฎุชูุงุฑูุ ููุชูุธูู)
- **ููุงุญุธุฉ:** ููุถู ุฃู ูููู ุงูุชููู ูุญุณุงุจ ุฌุฏูุฏ ุชูุงูุงู ูุชุฌูุจ ุงูุญุธุฑ ุนูู ุงูุญุณุงุจ ุงูุฑุฆูุณู.

---

## ๐ค ุงููุฑุญูุฉ 2: ููุงู ุงููุณุงุนุฏ ุงูุฐูู (Agent Tasks)

ุจูุฌุฑุฏ ุงุณุชูุงู ุงูุชูููุ ุณุฃููู ุจุชูููุฐ ุงูุฎุทูุงุช ุงูุชุงููุฉ ุขููุงู ูุจุฏูู ุชุฏุฎู ููู:

### 1. ุฅูุดุงุก ุงููุณุชูุฏุน (Private Repos)
- ุณุฃููู ุจุฅูุดุงุก ุฑูุจู ุฌุฏูุฏ ุจุงุณู ููุงุณู (ูุซูุงู: `server-03-worker`) ุจุงุณุชุฎุฏุงู ุงูุชููู.
- **ุชูุงุฏู ุงูุฎุทุฃ:** ุณุฃุชุญูู ุฃููุงู ุฅุฐุง ูุงู ุงูุงุณู ููุฌูุฏุงู.

### 2. ุถุจุท ุฅุนุฏุงุฏุงุช Git (Orphan Branch Strategy)
- **ุงููุดููุฉ ุงูุณุงุจูุฉ:** ุชุถุงุฑุจ `main` vs `master` ูุชุณุฑุจ ุงูุชููู ูู ุงูู History.
- **ุงูุญู:**
  1. ุฅูุดุงุก ูุฑุน ูุธูู `clean_deploy`.
  2. ูุณุฎ ุงููููุงุช ุงูุถุฑูุฑูุฉ ููุท (`.github/workflows`, `fb_otp_browser.py`, `requirements.txt`).
  3. ุญุฐู ุฃู ูููุงุช ุญุณุงุณุฉ ุฃู ุบูุฑ ุถุฑูุฑูุฉ.
  4. ุงูุฑูุน ุงูุฅุฌุจุงุฑู (`force push`) ุฅูู ูุฑุน `main` ูุจุงุดุฑุฉ.

### 3. ุชูุนูู GitHub Actions (API)
- **ุงููุดููุฉ ุงูุณุงุจูุฉ:** ุงูู Workflows ูุนุทูุฉ ุงูุชุฑุงุถูุงู ูู ุงูุญุณุงุจุงุช ุงูุฌุฏูุฏุฉ.
- **ุงูุญู:** ุฅุฑุณุงู ุทูุจ `PUT` ูุชูููู Actions ูุงูุณูุงุญ ุจุฌููุน ุงูุตูุงุญูุงุช.

### 4. ุฅุถุงูุฉ Secrets (Encryption)
- **ุงููุดููุฉ ุงูุณุงุจูุฉ:** ูุดู ุงูุฅุดุนุงุฑุงุช ุจุณุจุจ ุบูุงุจ ุงูุชูููุงุช.
- **ุงูุญู:** ุงุณุชุฎุฏุงู ุณูุฑุจุช `manage_secrets.py` (ูุน ููุชุจุฉ `PyNaCl`) ูุฅุถุงูุฉ:
  - `TELEGRAM_TOKEN`
  - `TELEGRAM_CHAT_ID`

### 5. ุฅุถุงูุฉ ุงูุณูุฑูุฑ ุฅูู Heroku
- **ุงููุดููุฉ ุงูุณุงุจูุฉ:** ูุงู ูุฌุจ ุชุนุฏูู ุงูููุฏ ูุฅุถุงูุฉ ุณูุฑูุฑ.
- **ุงูุญู:** ุฅุถุงูุฉ ูุชุบูุฑุงุช ุงูุจูุฆุฉ ูุจุงุดุฑุฉ:
  - `heroku config:set SERVER_3_REPO=username/repo`
  - `heroku config:set SERVER_3_TOKEN=ghp_...`
  - `heroku config:set SERVER_3_BRANCH=main` (ุฅูุฒุงูู)

---

## ๐๏ธ ุณูุฑุจุช ุงูุชุดุบูู ุงูููุงุณู (ูููุณุฎ ูุงููุตู ูููุทูุฑ)

ูุฐุง ููุฎุต ููุฃูุงูุฑ ุงูุชู ุณุฃููุฐูุง (ููุฑุฌุน):

```bash
# 1. Enable Actions
curl -X PUT -H "Authorization: Bearer $NEW_TOKEN" .../actions/permissions -d '{"enabled":true}'

# 2. Add Secrets
python manage_secrets.py --repo $NEW_REPO --token $NEW_TOKEN

# 3. Deploy Code (Clean History)
git checkout --orphan temp_deploy
git add .github fb_otp_browser.py
git commit -m "Init Server"
git push https://$NEW_TOKEN@github.com/$NEW_REPO.git temp_deploy:main -f

# 4. Configure Heroku
heroku config:set SERVER_3_REPO=$NEW_REPO SERVER_3_TOKEN=$NEW_TOKEN SERVER_3_BRANCH=main
```

---

## โ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ
ุจูุฌุฑุฏ ุฃู ุฃููู ูู "ุชู"ุ ููููู ุงูุฐูุงุจ ููุจูุช ูุงุฎุชูุงุฑ ุงูุณูุฑูุฑ ุงูุฌุฏูุฏ ููุฑุงู ูุณูุนูู ุจูุณุจุฉ 100%. ๐
